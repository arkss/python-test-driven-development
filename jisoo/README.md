# TDD 개념 정리

## 2장 - unittest 모듈을 이용한 기능 테스트 확장

기능 테스트(Functional Test, FT) : 애플리케이션이 어떻게 동작하는지 테스트 하는 것

FT는 스토리를 가지고 있어야 하며, 분명하게 정의를 하고 주석으로 기록한다. 스토리는 누구나 이해 가능 해야 함.

### class unittest.TestCase
TestCase 클래스의 인스턴스는 unittest에서 논리적인 테스트 단위에 해당한다.

#### setUp(self)
테스트 메서드 호출하기 바로 직전에 호출된다.

#### tearDown(self)
테스트 메서드가 불리고 결과가 기록되고 나서 바로 다음에 호출되는 메서드. 에러가 발생해도 호출된다.

#### setUpClass(cls)
테스트 실행 전에 호출되는 클래스 메서드
클래스만 인자로 받아서 호출되고 `@classmethod()` 데코레이트가 필요하다.

#### tearDownClass(cls)
테스트 실행 뒤에 호출되는 클래스 메서드
클래스만 인자로 받아서 호출되고 `@classmethod()` 데코레이트가 필요하다.

#### skipTest()
테스트 메서드나 setUp()에서 호출하면 현재 테스트를 건너뛴다.

#### debug()
값을 검사하고 실패를 확인하기 위해 사용하는 메서드
`assertEqual(a, b)` : a == b
`assertNotEqual(a, b)` : a!= b
`assertTrue(x)` : bool(x) is True
`assertFalse(x)` : bool(x) is False
`assertIs(a, b)` : a is b
`assertIsNot(a, b)` : a is not b
`assertIsNone(x)` : X is None
`assertIsNotNone(x)` : X is not None
`assertIn(a, b)` : a in b
`assertNotIn(a, b)` : a not in b

## 3장 - 단위 테스트를 이용한 간단한 홈페이지 테스트

기능 테스트(FT)는 사용자 관점에서 애플리케이션 외부를 테스트 하는 것이고, 
**단위 테스트(Unit Test)** 는 프로그래머 관점에서 그 내부를 테스트 하는 것이다.

기능 테스트는 제대로 된 기능성을 갖춘 애플리케이션을 만들게 도와주고,단위 테스트는 깔끔하고 버그 없는 코드를 작성하도록 돕는다.

### Test 작성 순서
1. 기능 테스트 작성 - 사용자 관점에서 새로운 기능을 정의한다.
2. 기능 테스트가 실패하고 나면, 어떻게 코드를 작성해야 테스트를 통과할지 단위 테스트를 이용해서 정의한다.
3. 단위 테스트가 실패하고 나면 단위 테스트를 통과할 수 있을 정도의 최소한의 코드만 작성한다.
기능 테스트가 완전할 때까지 2, 3을 반복한다.
4. 기능 테스트를 재실행해서 통과하는지 확인한다.


### unittest의 코드 주기
1. 어떻게 실패하는지 확인한다.
2. 실패 테스트를 수정하기 위한 최소한의 코드를 변경한다.

작은 단위로 나누어서 테스트를 해야 한다.


### 우리가 테스트 할 것은?

#### 장고의 흐름
1. 특정 URL에 대한 HTTP 요청을 받는다.
2. 해당 요청에 어떤 뷰 함수를 실행할지 결정한다. - URL 해석
3. 요청을 처리해서 HTTP 응답으로 반환한다.

여기서 우리가 테스트 해야 하는 것은
- 특정 뷰 기능에 매칭 할 수 있는지
- 뷰가 응답을 반환하게 해서 기능 테스트를 통과할 수 있는지

---

`resolve` : 장고 내부적으로 사용하는 함수로 URL을 해석해서 일치하는 뷰 함수를 찾는다.


## 4장 - 왜 테스트를 하는 것인가?

TDD는 다음에 무엇을 해야 할지 잊어버릴 걱정이 없다. 테스트를 실행하면 다음 작업이 무엇인지 알 수 있기 때문

커밋은 가장 작은 단위로 하는 것이 좋다.

#### 상수는 테스트 하지 마!
단위 테스트는 로직이나 흐름 제어, 설정 등을 테스트 하는 건데 상수는 아무런 의미가 없다.

리팩터링 : 기능은 바꾸지 않고 코드를 개선하는 것

`render(request, template)` : 앱 폴더 내에 template 폴더를 자동으로 만들어 준다. 그리고 템플릿 기반으로 HttpResponse를 만들어준다.

#### 전체적인 TDD 프로세스
`테스트 작성 - 실패 - 최소 코드 작성` 을 성공할 때 까지 반복
`테스트 성공 - 리팩터링 - 테스트 작성 - `  다시 반복

#### 기능 테스트 & 단위 테스트
기능 테스트와 단위 테스트를 모두 사용하는 것을 Double Loop TDD라고 한다.

기능 테스느는 애플리케이션이 동작하는지 아닌지 판단하는 수단
단위 테스트는 이 판단을 돕기 위한 툴


## 5장 - 사용자 입력 저장하기

TDD의 핵심은 하 번에 한 가지만 하는 것

#### 테스트 구조
설정(Setup), 처리(Exercise), 어설션(Assert)은 단위 테스트의 전형적인 구조이다.

#### 스트라이크 세 개면 리팩터링
같은 코드가 세 번 나오면 중복을 제거해야 한다.

#### 각 테스트는 하나의 기능만 테스트 해야 한다.
여러 기능을 하는 테스트는 나누는 것이 좋다

#### 알아두면 유용한 TDD 개념
- Regression
동작하던 애플리케이션 처리가 새로 추가된 코드에 의해 망가지는 것

- Unexpected failuer (예상치 못한 실패)
생각하지 못한 방법으로 테스트가 실패하는 것. 코드 수정이 필요한 경우이다.

- Red/Green/Refactor
TDD처리를 기술하는 다른 방법이다. 테스트를 작성해서 실패하는지 보고(Red), 코드를 수정해서 통과하게 한다(Green). 그리고 리팩터링해서 코드를 개선한다.

- Triangulation
기존 코드에 구체적인 테스트 케이스를 추가해서 일반화 한 처리를 정당화 하는 것

- Three strikes and refactor
세 번째 동일한 코드가 나오면 중복을 제거해야 한다.

## 6장 - 최소 동작 사이트 구축

유효한 파이썬 패키지 디렉터리를 만드는 방법 -> 디렉터리 내에 `__init__.py` 파일을 만들어 준다.


#### 필요한 경우에는 최소한의 설계를
TDD는 애자일 방법과 밀접한 관련이 있다. 애자일은 이론보다는 실제 상황을 통해 문제를 해결하는 것을 바탕으로 한다.

가능한 빨리 동작하는 최소한의 애플리케이션을 만들고, 이를 이용해서 얻은 실제 사용자 의견을 설계에 점진적으로 반영해 가는 방식이다.

#### 알게된 것
- REST(Representational State Transfer)
데이터 구조를 URL 구조에 일치시키는 방식이다. 
- assertRegex : unittest에 부속된 헬퍼 함수로, 지정한 정규포현과 문자열이 일치하는지 확인한다.
- 꼬리 슬래시가 붙지 않는 경우: 데이터베이스에 변경을 가하는 '액션' URL인 경우
- `.item_set` : reverse lookup 이라 불린다. 다른 테이블에 있는 아이템과 관련된 객체를 찾아준다.
- `'/lists/%d/' % (item.id)` : 이런 식으로 표현 할 수 있다.

### 논의 해볼 것

## 7장 - 멋있게 만들기: 레이아웃, 스타일링, 테스트

### 알게된 점
- 정적 파일은 smoke 테스트를 통해 CSS가 로딩됐는지 확인한다.
- `col-md-offset-6 col-md-offset-3` 선택자를 사용하면 6 크기만큼의 그리드가 오른쪽으로 3 크기만큼 떨어져 중앙에 배치된다.
- 웹 서버에서 장고가 정적 컨텐츠를 제공하는 것은 매우 느리며 비효율적이기 때문에 정적 파일을 모아서 배포용으로 만들어 둔다. 이 작업을 해주는 것이 `collectstatic`이다. 정적 파일이 모이는 위치는 settings.py의 STATIC_ROOT 항목을 통해 설정된다.

### 논의 사항
- `StaticLiveServerCase` 가 아니고 `StaticLiveServerTestCase` 가 맞음